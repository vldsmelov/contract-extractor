name: contract_extractor

services:
  api:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: contract-extractor-api
    environment:
      - MODEL=${MODEL:-krith/qwen2.5-32b-instruct:IQ4_XS}
      - TEMPERATURE=${TEMPERATURE:-0.1}
      - MAX_TOKENS=${MAX_TOKENS:-1024}
      - OLLAMA_HOST=http://ollama:11434
      - NUMERIC_TOLERANCE=${NUMERIC_TOLERANCE:-0.01}
      - USE_LLM=${USE_LLM:-true}
      - API_PORT=${API_PORT:-8085}
    networks:
      - ollama-net
    command: uvicorn app.main:app --host 0.0.0.0 --port 8085 --reload --log-level info
    ports:
      - "${API_PORT:-8085}:8085"
    healthcheck:
      test: ["CMD-SHELL", "curl -fsS http://127.0.0.1:8085/healthz >/dev/null || exit 1"]
      interval: 15s
      timeout: 5s
      retries: 20
    restart: unless-stopped
    extra_hosts:
      - "host.docker.internal:host-gateway"

networks:
  ollama-net:
    external: true